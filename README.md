# Discord RPG Bot - イニシエダンジョン

日本語のテキストベースRPGゲームをDiscordで楽しめるボットです。曜日別レイドボスシステムを搭載！

## 🌟 主な機能

### 基本システム
- テキストベースの探索型RPG
- 100階層のダンジョン
- 装備・アイテム・スキルシステム
- 死亡カウントとループシステム
- 称号システム
- ストーリーイベント

### 🆕 レイドボスシステム
500m毎に出現する協力型レイドボス戦！全プレイヤーで協力して倒せ！

#### レイドボスの特徴
- **曜日別ボス**: 月曜〜日曜まで異なるボスが登場
  - 月曜: 古代の巨像ゴーレム 🗿
  - 火曜: 炎竜インフェルノ 🐉
  - 水曜: 深海の支配者クラーケン 🦑
  - 木曜: 魔界将軍ベリアル 👹
  - 金曜: 不死王リッチロード 💀
  - 土曜: 雷神タイタン ⚡
  - 日曜: 不死鳥フェニックス 🔥

- **専用ステータス**: レイド専用のHP/ATK/DEFを使用
- **永続的進行**: !resetコマンドでも削除されない
- **6時間HP回復**: 自動的にHPが回復（アップグレード可能）
- **貢献度報酬**: ダメージ貢献度に応じた報酬
- **討伐通知**: 5%以上貢献したプレイヤーが特別チャンネルで発表

## 🎮 レイドコマンド

### 情報・ステータス
```
!raid_info (!ri)       - 現在のレイドボス情報を表示
!raid_upgrade (!ru)    - レイドステータスとアップグレードメニューを表示
```

### アップグレード
```
!raid_atk (!ra)        - レイド攻撃力+5 (コスト: 3PT)
!raid_def (!rd)        - レイド防御力+3 (コスト: 3PT)
!raid_hp (!rh)         - レイド最大HP+50 (コスト: 5PT)
!raid_heal (!rhe)      - レイドHP全回復 (コスト: 1PT)
!raid_recovery (!rr)   - 6時間HP回復量+5 (コスト: 4PT)
```

## 📦 セットアップ

### 必要な環境
- Python 3.11以上
- Discord Bot Token
- Supabase アカウント（PostgreSQLデータベース）

### 1. 依存パッケージのインストール
```bash
pip install -r requirements.txt
```

### 2. Supabaseデータベースのセットアップ

#### 2.1 Supabaseプロジェクトの作成
1. [Supabase](https://supabase.com)にアクセス
2. 新しいプロジェクトを作成
3. プロジェクトURLとANON KEYをメモ

#### 2.2 データベーススキーマの適用
Supabaseの SQL Editor で以下のSQLファイルを順番に実行：

1. `attached_assets/supabase_schema_1762125002111.sql` - 基本スキーマ
2. `migration_raid_hp_recovery.sql` - レイドHP回復システムの追加フィールド

### 3. 環境変数の設定
`.env`ファイルを作成し、以下の情報を入力：

```env
DISCORD_BOT_TOKEN=your_discord_bot_token_here
SUPABASE_URL=your_supabase_project_url_here
SUPABASE_KEY=your_supabase_anon_key_here
```

### 4. Botの起動
```bash
python main.py
```

## 🗄️ データベーススキーマ

### レイド関連テーブル

#### raid_bosses (レイドボス管理)
- 全プレイヤー共有のボスHP
- 曜日別の自動リセット
- 討伐状態の追跡

#### player_raid_stats (プレイヤーのレイド専用ステータス)
- raid_hp / raid_max_hp - レイド専用HP
- raid_atk / raid_def - レイド専用攻撃力・防御力
- raid_hp_recovery_rate - 6時間ごとのHP回復量
- last_hp_recovery - 最後の回復時刻
- アップグレードレベルの記録

#### raid_contributions (貢献度記録)
- プレイヤーごとのダメージ貢献
- 攻撃回数の記録
- 報酬計算に使用

## 🔧 技術仕様

### HP自動回復システム
- **回復間隔**: 6時間
- **基本回復量**: 10 HP
- **アップグレード**: 1レベルごとに+5 HP/6時間
- **処理タイミング**: プレイヤーがレイドステータスを取得する度に自動チェック

### 討伐通知
- **通知チャンネル**: 1424712515396305007
- **表示条件**: 総ダメージの5%以上を与えたプレイヤー
- **表示内容**: ユーザー名、与えたダメージ、貢献度パーセンテージ

### !resetコマンドの動作
- **削除対象**: players テーブルのデータ、冒険チャンネル
- **保持対象**: player_raid_stats テーブル（レイド専用ステータス）
- **理由**: レイドは永続的な進行システムとして設計

## 🎯 ゲームの流れ

1. **!start** で冒険を開始
2. **!move** でダンジョンを探索
3. 500m毎にレイドボスと遭遇
4. レイド専用HPで挑戦（通常のHPは消費しない）
5. ダメージを与えて貢献度を稼ぐ
6. 全プレイヤーの協力でボスを討伐
7. 貢献度に応じた報酬を獲得
8. アップグレードポイントでレイド能力を強化

## 📝 開発ノート

### 実装された機能
✅ 曜日別レイドボス（7種類）
✅ レイド専用ステータスシステム
✅ 6時間HP自動回復
✅ HP回復速度アップグレード
✅ 貢献度に基づく報酬計算
✅ 5%以上貢献者の通知システム
✅ !resetでのレイドデータ保護
✅ JST（日本標準時）での日次リセット

### 今後の拡張可能性
- レイドボスの追加バリエーション
- 期間限定イベントボス
- レイドランキングシステム
- ギルド/パーティシステム

## 📜 ライセンス

このプロジェクトは教育目的で作成されました。

## 🤝 貢献

バグ報告や機能提案は Issue でお願いします。

---

**開発者向けメモ**: Koyebでのデプロイ時は環境変数の設定を忘れずに！
